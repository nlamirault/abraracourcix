machine:
  pre:
    - curl -o go.tar.gz -sL https://golang.org/dl/go1.5.linux-amd64.tar.gz
    - sudo rm -rf /usr/local/go
    - sudo tar -C /usr/local -xzf go.tar.gz
    - sudo chmod a+w /usr/local/go/src/
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"
  override:
    - docker info
    - docker pull redis:3
    - docker pull mongo:3.1
  post:
    - go get github.com/golang/glog
    - go get -u github.com/Masterminds/glide
    - go get -u github.com/Masterminds/rmvcsdir
    - go get github.com/golang/lint/golint
    - go get github.com/kisielk/errcheck

test:
  pre:
    - go version
  override:
    - docker run -d -p 6379:6379 --name redis redis:3; sleep 20
    - docker run -d -p 27017:27017 --name mongo mongo:3.1; sleep 20
    - make build
    - make test
    - make lint
    - make vet
    - make coverage
